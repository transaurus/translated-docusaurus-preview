---
title: Towards Docusaurus 2
authors: endiliey
tags: [new, adoption]
---

Docusaurus在[官方公告](https://v1.docusaurus.io/blog/2017/12/14/introducing-docusaurus)发布九个月以来，已成为构建开源文档网站的便捷工具。截至目前，该项目已获得超过8,600个GitHub星标，并被[React Native](https://facebook.github.io/react-native/)、[Babel](https://babeljs.io/)、[Jest](https://jestjs.io/)、[Reason](https://reasonml.github.io/)和[Prettier](https://prettier.io/)等众多知名开源项目采用。

有句话说，最好的软件永远在进化，而最糟糕的则停滞不前。或许您已有所耳闻，我们正在筹划并开发Docusaurus的下一代版本🎉。

<!--truncate-->

## 引言

这一切始于2018年6月底[Yangshun](https://github.com/yangshun)提交的[RFC议题](https://github.com/facebook/docusaurus/issues/789)。

<blockquote>
  <h4>
    <a href="https://github.com/facebook/docusaurus/issues/789">
      {'[RFC] Docusaurus v2 · Issue #789 · facebook/docusaurus'}
    </a>
  </h4>
  These are some of the problems I'm seeing in Docusaurus now and also how we can
  address them in v2. A number of the ideas here were inspired by VuePress and other
  static site generators. In the current static site generators ecosystem, t...
</blockquote>

议题中已提及大部分改进建议，我将重点阐述Docusaurus 1存在的若干问题及我们在Docusaurus 2中的解决方案。

## 基础设施

### 内容处理

Docusaurus 1生成的网站实际上是一组静态HTML页面。尽管使用了React框架，但并未充分发挥其组件状态等特性来实现动态交互页面。React仅被用作静态内容的模板引擎，交互功能需通过脚本标签和`dangerouslySetInnerHTML`强行注入😱。

此外，用户难以自定义内容加载方式。例如原生不支持Sass/Less等CSS预处理器，需要用户通过添加自定义脚本等非常规手段实现。

在Docusaurus 2中，我们将采用[webpack](https://webpack.js.org/)作为模块打包器，并彻底重构内容服务机制。添加CSS预处理器只需配置webpack加载器即可。**构建时将生成服务端渲染的应用程序版本**并输出对应HTML，使Docusaurus站点本质上成为同构/通用应用。该方案深受[Gatsby](https://github.com/gatsbyjs/gatsby)启发。

### 版本控制

长期使用Docusaurus的用户可能注意到：**仅当文档内容发生变更时**，系统才会创建版本化文档。

例如现有`docs/hello.md`文件：

```text
---
id: hello
title: hello
---
Hello world !
```

当**发布1.0.0版本**时，Docusaurus会生成`versioned_docs/version-1.0.0/hello.md`：

```text
---
id: version-1.0.0-hello
title: hello
original_id: hello
---
Hello world !
```

但若发布v2.0.0时`hello.md`未作修改，系统不会为该文档创建版本化副本。也就是说`versioned_docs/version-2.0.0/hello.md`将不存在。

这极易导致用户困惑：如需编辑v2.0.0文档，必须修改`versioned_docs/version-1.0.0/hello.md`或手动创建`versioned_docs/version-2.0.0/hello.md`。这种机制可能引发意外错误，[Jest项目就曾遭遇此问题](https://github.com/facebook/jest/pull/6758#issuecomment-408274413)。

此外，这增加了代码库的复杂性，因为我们需要实现版本回退机制。在构建时，Docusaurus 必须替换为正确版本的链接。这也是导致[重命名文档会破坏旧版本链接](https://github.com/facebook/docusaurus/issues/845)这一缺陷的根本原因。

在 Docusaurus 2 中，**每次创建新版本时，我们将改为对所有文档进行快照**。不再要求文档内容必须发生变更。这是用空间复杂度换取更好的开发者和用户体验。我们将使用更多存储空间来实现更清晰的关注点分离和确定性正确。

### 国际化翻译

Docusaurus 通过 [Crowdin](https://crowdin.com/) 提供便捷的翻译功能。英文撰写的文档文件会上传至 Crowdin 供社区用户翻译。我们始终假设**英语**是默认语言，但这并非所有用户的情况。我们已经看到许多非英语开源项目使用 Docusaurus。

在 Docusaurus 2 中，**我们将不再假定英语是默认语言**。当用户启用国际化功能时，必须在 `siteConfig.js` 中设置默认语言。之后我们会假定 `docs` 目录下所有文件都使用该语言编写。

此外，在完成 Docusaurus 2 的最小可行产品后，我意识到可以不依赖 Crowdin 进行翻译。因此我们可能需要添加额外的工作流来支持这种场景。不过我们仍会强烈推荐使用 Crowdin 以获得更便捷的集成体验。

## 可定制性

### 布局

当前 Docusaurus 完全控制布局和样式设计，这无意中导致用户难以按需自定义网站外观。

在 Docusaurus 2 中，**布局和样式将交由用户控制**。Docusaurus 仅负责内容生成、路由、翻译和版本管理。受 [create-react-app](https://github.com/facebook/create-react-app) 和 [VuePress](https://vuepress.vuejs.org/) 启发，Docusaurus 仍会提供可退出的默认主题，支持通过 [React Helmet](https://github.com/nfl/react-helmet) 修改 HTML 元数据。社区主题也将成为可能。这种由用户掌控布局和样式的方式已被多数静态站点生成器采用。

### Markdown

当前我们的 Markdown 解析由 [Remarkable](https://github.com/jonschlinkert/remarkable) 驱动。如果用户想使用 [Markdown-it](https://github.com/Markdown-it/Markdown-it) 或 [MDX](https://github.com/mdx-js/mdx) 怎么办？还有语法高亮方案的选择问题（如 [Prism](https://prismjs.com/) 与 [Highlight.js](https://highlightjs.org/)）。这些选择权应该交给用户。

在 Docusaurus 2 中，**用户可以退出默认方案并选择自己的 Markdown 解析器**。无论是选用 [Remark](https://github.com/remarkjs/remark) 还是自研解析器都可以。基本原则是：用户需提供一个接收 _Markdown 原始字符串_作为子属性的 React 组件。默认情况下我们将继续使用 Remarkable 作为 Markdown 解析器，Highlight.js 作为语法高亮方案。最终默认解析器可能变更，因为我们仍在试验不同解析方案。

### 搜索

我们的核心搜索功能基于 [Algolia](https://www.algolia.com/) 实现。有用户提出希望使用其他搜索方案，例如支持离线搜索的 `lunrjs`。

我个人非常喜欢Algolia，我们与之合作体验极佳。他们的响应速度很快，而且由于他们的`DocSearch`是开源的，我们可以轻松提交Pull Request。例如，我最近提交了[这个PR，使DocSearch能够抓取站点地图中的多语言版本](https://github.com/algolia/docsearch-scraper/pull/387)。

在Docusaurus 2中，**我们将允许用户自定义搜索框**。用户只需从默认主题中弹出(eject)并修改搜索UI（一个React组件）即可。不过默认主题仍会使用Algolia。

## 稳定性

软件永远不可能完美，但我们希望Docusaurus在添加新功能时保持稳定。Docusaurus最初发布时没有完善的自动化测试套件，导致许多回归问题未能及早发现。虽然我们近期补充了大量测试，但测试覆盖率仍然偏低。

对于Docusaurus 2，**我们将在开发过程中同步编写测试**，因为这是全新的重写项目。因此我相信它会比以往更加稳定，相比Docusaurus 1更不容易出现破坏性变更。

## 常见问题

### 会有破坏性变更吗？

如果您通读了本文至此，应该能注意到将会存在破坏性变更。虽然我们会尽量**减少破坏性变更的数量**并保持向后兼容，但有些变更是必要的，这主要因为Docusaurus 2是对代码库进行的**重大重写和架构重构**。

具体的破坏性变更清单尚未完全确定，因为开发工作还未100%完成。但需要强调的是，我们将弃用`siteConfig.js`中的大量配置选项，力求保持其精简。例如`cleanUrl`配置将被弃用，因为Docusaurus 2的所有站点URL都将默认不带`.html`后缀。

我们的目标是让大多数站点能够无痛升级到Docusaurus 2。正式发布时我们会提供迁移指南。届时欢迎通过[Discord](https://discord.gg/docusaurus)或[X平台](https://x.com/docusaurus)联系我们获取帮助。

### Docusaurus 2何时发布？

目前我们还没有确切的发布日期。我个人预估可能在未来1-2个月内发布alpha版本，但这只是个粗略估计。

需要说明的是，虽然Docusaurus属于[Facebook开源项目](https://opensource.fb.com/)且核心团队多为Facebook员工，但维护开发工作主要在业余时间进行。我目前是[新加坡南洋理工大学](https://x.com/NTUsg)的应届毕业生，需要兼顾课程作业、毕业设计和Docusaurus的维护开发。但这不代表我们会降低对Docusaurus的要求，相反**我们致力于将其打造得尽善尽美**。

目前Docusaurus 2的实际开发工作仍在私有仓库进行。近期我们会将其迁移至[公开仓库](https://github.com/facebook/docusaurus)。届时欢迎大家参与贡献。在此之前，请保持关注😉！

## 最后总结

从[众多知名项目](https://v1.docusaurus.io/en/users)采用Docusaurus编写文档可以看出，它对开源社区产生了深远影响。为了加速未来发展，我们正着手解决Docusaurus 1的核心问题，致力于为所有人打造更优秀的版本。事实上，Docusaurus 2已不再是蓝图——开发工作已经启动，相信在不久的将来就能看到成果落地。

Docusaurus的使命始终是让您能轻松快速地搭建开箱即用的文档网站，这一使命在Docusaurus 2中不会改变。

我们也要说明：**由于Docusaurus 2的开发工作，我们将减少对Docusaurus 1新功能/重大改动的接纳。**

每位Docusaurus使用者都是社区成员，请持续反馈改进建议。若您认可我们的工作，可通过[Open Collective支持Docusaurus](https://opencollective.com/Docusaurus)。

> 若您通过[Open Collective](https://opencollective.com/Docusaurus)赞助我们，我们将为您提供Docusaurus网站维护与升级的专属技术支持。

最后提醒：若尚未操作，请为[GitHub仓库](https://github.com/facebook/docusaurus)点击**星标**与**关注**按钮，并在[X平台](https://x.com/docusaurus)关注我们。