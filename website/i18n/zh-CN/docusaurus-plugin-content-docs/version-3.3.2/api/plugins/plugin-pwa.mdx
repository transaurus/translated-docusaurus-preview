---
sidebar_position: 9
slug: /api/plugins/@docusaurus/plugin-pwa
---

# ğŸ“¦ plugin-pwa

Docusaurusæ’ä»¶ï¼Œé€šè¿‡[Workbox](https://developers.google.com/web/tools/workbox)æ·»åŠ PWAæ”¯æŒã€‚è¯¥æ’ä»¶ä»…åœ¨ç”Ÿäº§æ„å»ºæ—¶ç”Ÿæˆ[Service Worker](https://developers.google.com/web/fundamentals/primers/service-workers)ï¼Œä½¿æ‚¨çš„æ–‡æ¡£ç«™ç‚¹å…·å¤‡å®Œæ•´çš„PWAç‰¹æ€§ï¼ŒåŒ…æ‹¬ç¦»çº¿è®¿é—®å’Œå®‰è£…åŠŸèƒ½ã€‚

## å®‰è£… {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-pwa
```

## é…ç½® {#configuration}

åœ¨`./static/manifest.json`è·¯å¾„ä¸‹åˆ›å»º[PWAæ¸…å•æ–‡ä»¶](https://web.dev/add-manifest/)ã€‚

ä¿®æ”¹`docusaurus.config.js`æ–‡ä»¶ï¼Œæ·»åŠ æœ€å°åŒ–PWAé…ç½®ï¼Œä¾‹å¦‚ï¼š

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        debug: true,
        offlineModeActivationStrategies: [
          'appInstalled',
          'standalone',
          'queryString',
        ],
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json', // your PWA manifest
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
        ],
      },
    ],
  ],
};
```

## æ¸è¿›å¼Webåº”ç”¨ {#progressive-web-app}

ä»…å®‰è£…Service Workerå¹¶ä¸è¶³ä»¥ä½¿æ‚¨çš„åº”ç”¨æˆä¸ºPWAã€‚æ‚¨è‡³å°‘éœ€è¦åŒ…å«[Webåº”ç”¨æ¸…å•](https://developer.mozilla.org/en-US/docs/Web/Manifest)å¹¶åœ¨`<head>`ä¸­æ·»åŠ æ­£ç¡®çš„æ ‡ç­¾ï¼ˆå‚è§[é€‰é¡¹ > pwaHead](#pwahead)ï¼‰ã€‚

éƒ¨ç½²å®Œæˆåï¼Œå¯ä½¿ç”¨[Lighthouse](https://developers.google.com/web/tools/lighthouse)å¯¹ç«™ç‚¹è¿›è¡Œå®¡è®¡ã€‚

æ›´å®Œæ•´çš„PWAè¦æ±‚æ¸…å•ï¼Œè¯·å‚é˜…[PWAæ£€æŸ¥è¡¨](https://developers.google.com/web/progressive-web-apps/checklist)

## åº”ç”¨å®‰è£…æ”¯æŒ {#app-installation-support}

è‹¥æµè§ˆå™¨æ”¯æŒï¼Œæ‚¨å¯å°†Docusaurusç«™ç‚¹ä½œä¸ºåº”ç”¨å®‰è£…ã€‚

![åº”ç”¨å®‰è£…æµç¨‹çš„å±å¹•å½•åˆ¶ã€‚æµè§ˆå™¨åœ°å€æ å‡ºç°å®‰è£…æŒ‰é’®ï¼Œç‚¹å‡»åæ˜¾ç¤º"æ˜¯å¦å®‰è£…æ­¤åº”ç”¨ï¼Ÿ"çš„å¯¹è¯æ¡†ã€‚ç‚¹å‡»"å®‰è£…"æŒ‰é’®åï¼Œæ“ä½œç³»ç»Ÿå°†æ‰“å¼€æ–°åº”ç”¨çª—å£å¹¶æ˜¾ç¤ºDocusaurusé¦–é¡µã€‚](/img/pwa_install.gif)

:::note

åº”ç”¨å®‰è£…éœ€è¦HTTPSåè®®å’Œæœ‰æ•ˆçš„æ¸…å•æ–‡ä»¶ã€‚

:::

## ç¦»çº¿æ¨¡å¼ï¼ˆé¢„ç¼“å­˜ï¼‰ {#offline-mode-precaching}

é€šè¿‡Service Workeré¢„ç¼“å­˜æŠ€æœ¯ï¼Œç”¨æˆ·å¯ç¦»çº¿æµè§ˆDocusaurusç«™ç‚¹ã€‚

[workbox-precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching)é¡µé¢é˜è¿°äº†å…¶åŸç†ï¼š

> Service Workerçš„æ ¸å¿ƒç‰¹æ€§ä¹‹ä¸€æ˜¯åœ¨å®‰è£…é˜¶æ®µå°†æ–‡ä»¶é›†åˆä¿å­˜è‡³ç¼“å­˜ï¼Œæ­¤è¿‡ç¨‹ç§°ä¸º"é¢„ç¼“å­˜"ã€‚å¼€å‘è€…å› æ­¤èƒ½å®Œå…¨æ§åˆ¶ç¼“å­˜æœºåˆ¶â€”â€”å†³å®šæ–‡ä»¶ç¼“å­˜æ—¶æœºã€æŒç»­æ—¶é—´ï¼Œå¹¶èƒ½ç›´æ¥å‘æµè§ˆå™¨æä¾›ç¼“å­˜å†…å®¹è€Œæ— éœ€ç½‘ç»œè¯·æ±‚ï¼Œä»è€Œå®ç°ç¦»çº¿Webåº”ç”¨ã€‚
>
> Workboxæå¤§ç®€åŒ–äº†é¢„ç¼“å­˜APIï¼Œå¹¶ç¡®ä¿èµ„æºé«˜æ•ˆä¸‹è½½ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç«™ç‚¹ä½œä¸ºåº”ç”¨å®‰è£…æ—¶ä¼šå¯ç”¨ç¦»çº¿æ¨¡å¼ã€‚è¯¦è§`offlineModeActivationStrategies`é€‰é¡¹è¯´æ˜ã€‚

ç«™ç‚¹å®Œæˆé¢„ç¼“å­˜åï¼ŒService Workerå°†ä¸ºåç»­è®¿é—®æä¾›ç¼“å­˜å“åº”ã€‚å½“æ–°æ„å»ºç‰ˆæœ¬éƒ¨ç½²å¹¶ä¼´éšæ–°Service Workeræ—¶ï¼Œæ–°Workerå°†å¼€å§‹å®‰è£…å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚æ­¤æ—¶ä¼šæ˜¾ç¤ºé‡æ–°åŠ è½½å¼¹çª—ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°é¡µé¢è·å–æ–°å†…å®¹ã€‚åœ¨ç”¨æˆ·æ¸…é™¤åº”ç”¨ç¼“å­˜æˆ–ç‚¹å‡»å¼¹çª—çš„`reload`æŒ‰é’®å‰ï¼ŒService Workerå°†æŒç»­æä¾›æ—§ç‰ˆæœ¬å†…å®¹ã€‚

:::warning

ç¦»çº¿æ¨¡å¼/é¢„ç¼“å­˜éœ€è¦æå‰ä¸‹è½½ç«™ç‚¹æ‰€æœ‰é™æ€èµ„æºï¼Œå¯èƒ½é€ æˆä¸å¿…è¦çš„å¸¦å®½æ¶ˆè€—ã€‚å¹¶éæ‰€æœ‰ç±»å‹ç«™ç‚¹éƒ½é€‚åˆå¯ç”¨æ­¤åŠŸèƒ½ã€‚

:::

## é€‰é¡¹ {#options}

### `debug` {#debug}

- ç±»å‹: `boolean`
- é»˜è®¤å€¼: `false`

å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š

- Workbox æ—¥å¿—
- é¢å¤–çš„ Docusaurus æ—¥å¿—
- æœªä¼˜åŒ–çš„æœåŠ¡å·¥ä½œè€…æ–‡ä»¶è¾“å‡º
- æºä»£ç æ˜ å°„

### `offlineModeActivationStrategies` {#offlinemodeactivationstrategies}

- ç±»å‹: `('appInstalled' | 'mobile' | 'saveData'| 'queryString' | 'always')[]`
- é»˜è®¤å€¼: `['appInstalled', 'queryString', 'standalone']`

ç”¨äºæ¿€æ´»ç¦»çº¿æ¨¡å¼çš„ç­–ç•¥ï¼š

- `appInstalled`: å¯¹å·²å®‰è£…ç«™ç‚¹ä¸ºåº”ç”¨çš„ç”¨æˆ·ç”Ÿæ•ˆï¼ˆå¹¶é100%å¯é ï¼‰
- `standalone`: å¯¹ä»¥ç‹¬ç«‹åº”ç”¨æ¨¡å¼è¿è¡Œçš„ç”¨æˆ·ç”Ÿæ•ˆï¼ˆå¸¸è§äºPWAå®‰è£…ååœºæ™¯ï¼‰
- `queryString`: å½“æŸ¥è¯¢å­—ç¬¦ä¸²åŒ…å«`offlineMode=true`æ—¶ç”Ÿæ•ˆï¼ˆä¾¿äºPWAè°ƒè¯•ï¼‰
- `mobile`: å¯¹ç§»åŠ¨ç«¯ç”¨æˆ·ç”Ÿæ•ˆï¼ˆ`width <= 996px`ï¼‰
- `saveData`: å¯¹`navigator.connection.saveData === true`çš„ç”¨æˆ·ç”Ÿæ•ˆ
- `always`: å¯¹æ‰€æœ‰ç”¨æˆ·å¼ºåˆ¶ç”Ÿæ•ˆ

:::warning

è¯·è°¨æ…ä½¿ç”¨ï¼šéƒ¨åˆ†ç”¨æˆ·å¯èƒ½ä¸å–œæ¬¢è¢«å¼ºåˆ¶ä½¿ç”¨ç¦»çº¿æ¨¡å¼ã€‚

:::

:::danger

ç›®å‰æ— æ³•å¯é æ£€æµ‹é¡µé¢æ˜¯å¦ä»¥PWAå½¢å¼æ¸²æŸ“ã€‚

`appinstalled`äº‹ä»¶å·²[ä»è§„èŒƒä¸­ç§»é™¤](https://github.com/w3c/manifest/pull/836)ï¼Œä¸”[`navigator.getInstalledRelatedApps()`](https://web.dev/get-installed-related-apps/) APIä»…åœ¨æ–°ç‰ˆChromeä¸­æ”¯æŒï¼Œå¹¶è¦æ±‚manifestä¸­å£°æ˜`related_applications`ã€‚

[`standalone`ç­–ç•¥](https://petelepage.com/blog/2019/07/is-my-pwa-installed/)å¯ä½œä¸ºæ¿€æ´»ç¦»çº¿æ¨¡å¼çš„ä¼˜é›…é™çº§æ–¹æ¡ˆï¼ˆè‡³å°‘åœ¨è¿è¡Œå·²å®‰è£…åº”ç”¨æ—¶æœ‰æ•ˆï¼‰ã€‚

:::

### `injectManifestConfig` {#injectmanifestconfig}

ä¼ é€’ç»™`workbox.injectManifest()`çš„[Workboxé…ç½®é¡¹](https://developer.chrome.com/docs/workbox/reference/workbox-build/#type-InjectManifestOptions)ï¼Œç”¨äºæ§åˆ¶å“ªäº›èµ„æºå°†è¢«é¢„ç¼“å­˜å¹¶æ”¯æŒç¦»çº¿è®¿é—®ã€‚

- ç±»å‹: `InjectManifestOptions`
- é»˜è®¤å€¼: `{}`

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        injectManifestConfig: {
          manifestTransforms: [
            //...
          ],
          modifyURLPrefix: {
            //...
          },
          // We already add regular static assets (HTML, images...) to be available offline
          // You can add more files according to your needs
          globPatterns: ['**/*.{pdf,docx,xlsx}'],
          // ...
        },
      },
    ],
  ],
};
```

### `pwaHead` {#pwahead}

- ç±»å‹: `({ tagName: string; [attributeName: string]: string })[]`
- é»˜è®¤å€¼: `[]`

åŒ…å«`tagName`å’Œé”®å€¼å¯¹å±æ€§çš„å¯¹è±¡æ•°ç»„ï¼Œç”¨äºå‘`<head>`æ ‡ç­¾æ³¨å…¥å†…å®¹ã€‚æŠ€æœ¯ä¸Šå¯æ³¨å…¥ä»»æ„headæ ‡ç­¾ï¼Œä½†ç†æƒ³æƒ…å†µä¸‹åº”ç”¨äºä½¿ç«™ç‚¹ç¬¦åˆPWAè§„èŒƒçš„æ ‡ç­¾ã€‚ä»¥ä¸‹æ˜¯å®ç°å®Œå…¨åˆè§„æ‰€éœ€çš„æ ‡ç­¾åˆ—è¡¨ï¼š

```js
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json',
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-capable',
            content: 'yes',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-status-bar-style',
            content: '#000',
          },
          {
            tagName: 'link',
            rel: 'apple-touch-icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'mask-icon',
            href: '/img/docusaurus.svg',
            color: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileImage',
            content: '/img/docusaurus.png',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileColor',
            content: '#000',
          },
        ],
      },
    ],
  ],
};
```

### `swCustom` {#swcustom}

- ç±»å‹: `string | undefined`
- é»˜è®¤å€¼: `undefined`

ç”¨äºæ·»åŠ è‡ªå®šä¹‰Workboxè§„åˆ™ã€‚æ­¤å¤„å¯å®ç°æœåŠ¡å·¥ä½œè€…æ”¯æŒçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶å……åˆ†åˆ©ç”¨workboxåº“èƒ½åŠ›ã€‚ä»£ç ä¼šè¢«è½¬è¯‘ï¼Œå› æ­¤å¯ä½¿ç”¨ç°ä»£ES6+è¯­æ³•ã€‚

ä¾‹å¦‚ç¼“å­˜å¤–éƒ¨è·¯ç”±æ–‡ä»¶ï¼š

```js
import {registerRoute} from 'workbox-routing';
import {StaleWhileRevalidate} from 'workbox-strategies';

// default fn export receiving some useful params
export default function swCustom(params) {
  const {
    debug, // :boolean
    offlineMode, // :boolean
  } = params;

  // Cache responses from external resources
  registerRoute((context) => {
    return [
      /graph\.facebook\.com\/.*\/picture/,
      /netlify\.com\/img/,
      /avatars1\.githubusercontent/,
    ].some((regex) => context.url.href.match(regex));
  }, new StaleWhileRevalidate());
}
```

è¯¥æ¨¡å—éœ€å¯¼å‡º`default`å‡½æ•°ï¼Œå¹¶æ¥æ”¶è‹¥å¹²å‚æ•°ã€‚

### `swRegister` {#swregister}

- ç±»å‹: `string | false`
- é»˜è®¤å€¼: `'docusaurus-plugin-pwa/src/registerSW.js'`

åœ¨Docusaurusåº”ç”¨å‰æ·»åŠ æ³¨å†Œå…¥å£ï¼Œç¡®ä¿åº”ç”¨è¿è¡Œå‰å®Œæˆæ³¨å†Œã€‚é»˜è®¤çš„`registerSW.js`æ–‡ä»¶å·²æ»¡è¶³åŸºç¡€æ³¨å†Œéœ€æ±‚ã€‚

ä¼ å…¥`false`å°†å®Œå…¨ç¦ç”¨æ³¨å†ŒåŠŸèƒ½ã€‚

## æ¸…å•æ–‡ä»¶ç¤ºä¾‹ {#manifest-example}

Docusaurus ç«™ç‚¹æ¸…å•å¯ä½œä¸ºå‚è€ƒèŒƒä¾‹ï¼š

import CodeBlock from '@theme/CodeBlock';

<CodeBlock className="language-json">
  {JSON.stringify(require('@site/static/manifest.json'),null,2)}
</CodeBlock>

## è‡ªå®šä¹‰é‡æ–°åŠ è½½å¼¹çª— {#customizing-reload-popup}

å½“æœ‰æ–°æœåŠ¡å·¥ä½œè€…ç­‰å¾…å®‰è£…æ—¶ï¼Œä¼šæ¸²æŸ“ `@theme/PwaReloadPopup` ç»„ä»¶ï¼Œå¹¶å‘ç”¨æˆ·å»ºè®®é‡æ–°åŠ è½½ã€‚ä½ å¯ä»¥[ç½®æ¢](../../swizzling.mdx)è¯¥ç»„ä»¶å¹¶å®ç°è‡ªå·±çš„ UI ç•Œé¢ã€‚ç»„ä»¶ä¼šæ¥æ”¶ä¸€ä¸ª `onReload` å›è°ƒå‡½æ•°ä½œä¸º propsï¼Œåº”åœ¨ç‚¹å‡»"åˆ·æ–°"æŒ‰é’®æ—¶è°ƒç”¨æ­¤å‡½æ•°ã€‚è¿™å°†é€šçŸ¥æœåŠ¡å·¥ä½œè€…å®‰è£…ç­‰å¾…ä¸­çš„æœåŠ¡å·¥ä½œè€…å¹¶åˆ·æ–°é¡µé¢ã€‚

é»˜è®¤ä¸»é¢˜åŒ…å«é‡æ–°åŠ è½½å¼¹çª—çš„å®ç°ï¼Œå¹¶ä½¿ç”¨ [Infima è­¦å‘Šç»„ä»¶](https://infima.dev/docs/components/alert)ã€‚

![é‡æ–°åŠ è½½è¿‡ç¨‹çš„å±å¹•å½•åˆ¶ã€‚çª—å£å³ä¸‹è§’æ˜¾ç¤ºæç¤ºæ¡†ï¼Œå†…å®¹ä¸º"æœ‰æ–°å†…å®¹å¯ç”¨"ã€‚ç‚¹å‡»"åˆ·æ–°"æŒ‰é’®åï¼Œé¡µé¢ä¸»æ ‡é¢˜ä»"ç®€ä»‹"å˜ä¸º"PWA :))"ã€‚](/img/pwa_reload.gif)

ä½ çš„ç»„ä»¶å¯ä»¥æ¸²æŸ“ `null`ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšï¼šç”¨æˆ·å°†æ— æ³•è·å–æœ€æ–°å†…å®¹ã€‚