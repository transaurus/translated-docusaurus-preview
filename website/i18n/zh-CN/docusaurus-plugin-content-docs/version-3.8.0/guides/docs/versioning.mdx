---
slug: /versioning
---

# 版本管理

您可以使用版本管理CLI基于`docs`目录中的最新内容创建新的文档版本。该特定版本的文档将被保留并可访问，即使`docs`目录中的文档持续更新。

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

:::warning

在开始对文档进行版本管理前请三思——这可能会增加贡献者协助改进的难度！

:::

大多数情况下，您并不需要版本管理功能，因为这只会增加构建时间，并为代码库引入复杂性。版本管理**最适合文档变更频繁且访问量高的网站**。如果您的文档很少更新，请不要为文档添加版本管理功能。

要更好地理解版本管理的工作原理并判断是否符合您的需求，请继续阅读下文。

## 概述 {#overview}

典型的版本化文档站点结构如下：

```bash
website
├── sidebars.json        # sidebar for the current docs version
├── docs                 # docs directory for the current docs version
│   ├── foo
│   │   └── bar.md       # https://mysite.com/docs/next/foo/bar
│   └── hello.md         # https://mysite.com/docs/next/hello
├── versions.json        # file to indicate what versions are available
├── versioned_docs
│   ├── version-1.1.0
│   │   ├── foo
│   │   │   └── bar.md   # https://mysite.com/docs/foo/bar
│   │   └── hello.md
│   └── version-1.0.0
│       ├── foo
│       │   └── bar.md   # https://mysite.com/docs/1.0.0/foo/bar
│       └── hello.md
├── versioned_sidebars
│   ├── version-1.1.0-sidebars.json
│   └── version-1.0.0-sidebars.json
├── docusaurus.config.js
└── package.json
```

`versions.json`文件是按从新到旧排序的版本名称列表。

下表说明了版本化文件如何映射到其版本及生成的URL。

| Path                                    | Version        | URL               |
| --------------------------------------- | -------------- | ----------------- |
| `versioned_docs/version-1.0.0/hello.md` | 1.0.0          | /docs/1.0.0/hello |
| `versioned_docs/version-1.1.0/hello.md` | 1.1.0 (latest) | /docs/hello       |
| `docs/hello.md`                         | current        | /docs/next/hello  |

:::tip

`docs`目录中的文件属于`current`文档版本。

默认情况下，`current`文档版本被标记为`Next`并托管在`/docs/next/*`路径下，但您完全可以自定义配置以适应项目的发布周期。

:::

### 术语说明 {#terminology}

请注意我们使用的术语。

<dl>
  <dt>
    <b>Current version</b>
  </dt>
  <dd>
    {'The version placed in the '}
    <code>./docs</code>
    {' folder.'}
  </dd>
  <dt>
    <b>Latest version / last version</b>
  </dt>
  <dd>
    {'The version served by default for docs navbar items. Usually has path '}
    <code>/docs</code>
    {'.'}
  </dd>
</dl>

当前版本由**文件系统位置**定义，而最新版本由**导航行为**定义。它们可能是同一个版本，也可能不是！（如上表所示的默认配置就将它们视为不同版本：当前版本位于`/docs/next`，最新版本位于`/docs`。）

## 操作指南 {#tutorials}

### 标记新版本 {#tagging-a-new-version}

1. 首先确保当前文档版本（`./docs`目录）已准备就绪可冻结
2. 输入新版本号

```bash npm2yarn
npm run docusaurus docs:version 1.1.0
```

标记新版本时，文档版本管理机制将执行以下操作：

- 将完整的`docs/`文件夹内容复制到新的`versioned_docs/version-[versionName]/`文件夹
- 根据当前[侧边栏](./sidebar/index.mdx)配置（如果存在）创建版本化侧边栏文件——保存为`versioned_sidebars/version-[versionName]-sidebars.json`
- 将新版本号追加到`versions.json`文件中

### 创建新文档 {#creating-new-docs}

1. 将新文件放入对应版本的文件夹
2. 根据版本号在对应的侧边栏文件中添加新文件的引用

<Tabs>
<TabItem value="Current version structure">

```bash
# The new file.
docs/new.md

# Edit the corresponding sidebar file.
sidebars.js
```

</TabItem>
<TabItem value="Older version structure">

```bash
# The new file.
versioned_docs/version-1.0.0/new.md

# Edit the corresponding sidebar file.
versioned_sidebars/version-1.0.0-sidebars.json
```

</TabItem>
</Tabs>

:::tip

版本化侧边栏文件与标准侧边栏文件类似，都是相对于给定版本的内容根目录——因此对于上面的示例，您的版本化侧边栏文件可能如下所示：

```json
{
  "sidebar": [
    {
      "type": "autogenerated",
      "dirName": "."
    }
  ]
}
```

或手动配置的侧边栏：

```json
{
  "sidebar": [
    {
      "type": "doc",
      "id": "new",
      "label": "New"
    }
  ]
}
```

:::

### 更新现有版本 {#updating-an-existing-version}

您可以同时更新多个文档版本，因为`versioned_docs/`中的每个目录在发布时都代表特定的路由。

1. 编辑任意文件。
2. 提交并推送更改。
3. 变更将发布至对应版本。

示例：当您修改 `versioned_docs/version-2.6/` 目录下的文件时，仅会影响版本 `2.6` 的文档。

### 删除现有版本 {#deleting-an-existing-version}

您也可以删除/移除版本。

1. 从 `versions.json` 中移除目标版本。

示例：

```diff
[
  "2.0.0",
  "1.9.0",
  // highlight-next-line
- "1.8.0"
]
```

2. 删除版本化文档目录。示例：`versioned_docs/version-1.8.0`。
3. 删除版本化侧边栏文件。示例：`versioned_sidebars/version-1.8.0-sidebars.json`。

## 配置版本化行为 {#configuring-versioning-behavior}

"当前"版本是指向 `./docs` 文件夹的版本名称。版本管理存在不同模式，但两种最常见的情况是：

- 您发布了 v1 后立即开始开发 v2（包括其文档）。此时**当前版本**是位于 `./docs` 源文件夹的 v2，可通过 `example.com/docs/next` 访问；而**最新版本**是位于 `./versioned_docs/version-1` 源文件夹的 v1，大多数用户通过 `example.com/docs` 访问。
- 您发布 v1 后将持续维护一段时间才考虑 v2。此时**当前版本**和**最新版本**都指向 v1，因为 v2 文档尚未存在！

Docusaurus 的默认配置完美适配第一种情况。我们会将当前版本标记为"next"，您甚至可以选择不发布它。

**针对第二种情况**：如果您发布了 v1 且短期内不计划开发 v2，与其创建 v1 版本并维护两个文件夹的文档（`./docs` + `./versioned_docs/version-1.0.0`），可以考虑通过指定路径和标签"伪装"当前版本为已发布版本：

```js title="docusaurus.config.js"
export default {
  presets: [
    '@docusaurus/preset-classic',
    docs: {
      // highlight-start
      lastVersion: 'current',
      versions: {
        current: {
          label: '1.0.0',
          path: '1.0.0',
        },
      },
      // highlight-end
    },
  ],
};
```

这样 `./docs` 中的文档将通过 `/docs/1.0.0` 路径提供服务（而非 `/docs/next`），且 `1.0.0` 将成为导航栏下拉菜单的默认链接版本，您只需维护单个 `./docs` 文件夹。

我们提供以下插件选项来自定义版本化行为：

- `disableVersioning`：显式禁用版本控制，即使存在多个版本。这将使站点仅包含当前版本。
- `includeCurrentVersion`：包含当前版本（`./docs` 文件夹）的文档。
  - **提示**：如果当前版本是未完成的工作版本，尚未准备好发布，请关闭此选项。
- `lastVersion`：设置"最新版本"（`/docs` 路由）指向的版本。
  - **提示**：`lastVersion: 'current'` 适用于当前版本指向一个不断修补和发布的主版本的情况。最新版本的实际路由基础路径和标签是可配置的。
- `onlyIncludeVersions`：定义从 `versions.json` 中部署的版本子集。
  - **提示**：在开发和部署预览中限制为2或3个版本，以提高启动和构建时间。
- `versions`：版本元数据的字典。对于每个版本，您可以自定义以下内容：
  - `label`：在版本下拉列表和横幅中显示的标签。
  - `path`：此版本的路由基础路径。默认情况下，最新版本为 `/`，当前版本为 `/next`。
  - `banner`：`'none'`、`'unreleased'` 或 `'unmaintained'` 之一。决定在每个文档页面顶部显示的内容。任何高于最新版本的版本将标记为"unreleased"，低于的则标记为"unmaintained"。
  - `badge`：在该版本的文档顶部显示带有版本名称的徽章。
  - `className`：为该版本的文档页面的 `<html>` 元素添加自定义 `className`。

更多详情请参阅[文档插件配置](../../api/plugins/plugin-content-docs.mdx#configuration)。

## 导航栏项目 {#navbar-items}

我们提供了几个文档导航栏项目，帮助您快速设置导航，无需担心版本化路由。

- [`doc`](../../api/themes/theme-configuration.mdx#navbar-doc-link)：指向一个文档的链接。
- [`docSidebar`](../../api/themes/theme-configuration.mdx#navbar-doc-sidebar)：指向侧边栏中第一个项目的链接。
- [`docsVersion`](../../api/themes/theme-configuration.mdx#navbar-docs-version)：指向当前查看版本的主文档的链接。
- [`docsVersionDropdown`](../../api/themes/theme-configuration.mdx#navbar-docs-version-dropdown)：包含所有可用版本的下拉菜单。

这些链接将按照以下顺序寻找合适的版本来链接：

1. **活动版本**：用户当前浏览的版本，如果她正在查看此文档插件提供的页面。如果她不在文档页面上，则回退到...
2. **首选版本**：用户上次查看的版本。如果没有历史记录，则回退到...
3. **最新版本**：默认导航到的版本，由 `lastVersion` 选项配置。

## `docsVersionDropdown` {#docsVersionDropdown}

默认情况下，[`docsVersionDropdown`](../../api/themes/theme-configuration.mdx#navbar-docs-version-dropdown) 显示一个包含所有可用文档版本的下拉菜单。

`versions` 属性允许您以特定顺序显示可用文档版本的子集：

```js title="docusaurus.config.js"
export default {
  themeConfig: {
    navbar: {
      items: [
        {
          type: 'docsVersionDropdown',
          // highlight-start
          versions: ['current', '3.0', '2.0'],
          // highlight-end
        },
      ],
    },
  },
};
```

传递 `versions` 对象可以覆盖每个版本的显示标签：

```js title="docusaurus.config.js"
export default {
  themeConfig: {
    navbar: {
      items: [
        {
          type: 'docsVersionDropdown',
          // highlight-start
          versions: {
            current: {label: 'Version 4.0'},
            '3.0': {label: 'Version 3.0'},
            '2.0': {label: 'Version 2.0'},
          },
          // highlight-end
        },
      ],
    },
  },
};
```

## 推荐实践 {#recommended-practices}

### 仅在需要时对文档进行版本控制 {#version-your-documentation-only-when-needed}

例如，您正在为 npm 包 `foo` 构建文档，当前版本为 1.0.0。然后您发布了一个修补版本以修复一个小错误，现在版本为 1.0.1。

您应该为 1.0.1 创建一个新的文档版本吗？**可能不应该**。根据语义化版本控制，1.0.1 和 1.0.0 的文档不应该有差异，因为没有新功能！为此创建一个新版本只会产生不必要的重复文件。

### 控制版本数量 {#keep-the-number-of-versions-small}

作为最佳实践，建议将文档版本数量控制在10个以下。**极有可能**你会发现大量过时的版本化文档根本无人阅读。例如[Jest](https://jestjs.io/versions)当前版本为`27.4`，但仅维护几个最新文档版本（最低至`25.X`）。保持精简 😊

:::tip[归档旧版本]

如果您的站点部署在Jamstack提供商（如[Netlify](../../deployment.mdx)）上，提供商会将每次生产构建作为快照保存在不可变URL下。您可以将不再重建的归档版本作为外部链接指向这些不可变URL。Jest官网和Docusaurus官网都采用这种模式来减少活跃构建版本数量。

:::

### 在文档中使用绝对路径导入 {#use-absolute-import-within-the-docs}

不要在文档内使用相对路径导入。因为当我们创建版本时这些路径会失效（嵌套层级变化等原因）。可以利用Docusaurus提供的指向`website`目录的`@site`别名。例如：

```diff
- import Foo from '../src/components/Foo';
+ import Foo from '@site/src/components/Foo';
```

### 通过文件路径链接文档 {#link-docs-by-file-paths}

通过带`.md`扩展名的相对文件路径引用其他文档，这样Docusaurus在构建时能将其重写为实际URL路径。文件将被正确链接到对应版本。

```md
The [@hello](hello.mdx#paginate) document is great!

See the [Tutorial](../getting-started/tutorial.mdx) for more info.
```

### 全局或版本化共置资源 {#global-or-versioned-collocated-assets}

您需要决定资源（如图片和文件）是按版本隔离还是跨版本共享。

若资源需要版本化，请将其置于文档版本目录中，并使用相对路径：

```md
![img alt](./myImage.png)

[download this file](./file.pdf)
```

若资源是全局性的，请将其放入`/static`目录并使用绝对路径：

```md
![img alt](/myImage.png)

[download this file](/file.pdf)
```