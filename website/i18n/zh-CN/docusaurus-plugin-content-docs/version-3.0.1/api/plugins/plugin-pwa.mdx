---
sidebar_position: 9
slug: /api/plugins/@docusaurus/plugin-pwa
---

# ğŸ“¦ plugin-pwa

Docusaurus æ’ä»¶ï¼Œç”¨äºé€šè¿‡ [Workbox](https://developers.google.com/web/tools/workbox) æ·»åŠ  PWA æ”¯æŒã€‚è¯¥æ’ä»¶ä»…åœ¨ç”Ÿäº§æ„å»ºæ—¶ç”Ÿæˆ [Service Worker](https://developers.google.com/web/fundamentals/primers/service-workers)ï¼Œä½¿æ‚¨èƒ½å¤Ÿåˆ›å»ºå…·å¤‡ç¦»çº¿åŠŸèƒ½å’Œå®‰è£…æ”¯æŒçš„å®Œå…¨ç¬¦åˆ PWA æ ‡å‡†çš„æ–‡æ¡£ç«™ç‚¹ã€‚

## å®‰è£… {#installation}

```bash npm2yarn
npm install --save @docusaurus/plugin-pwa
```

## é…ç½® {#configuration}

åœ¨ `./static/manifest.json` å¤„åˆ›å»º [PWA æ¸…å•æ–‡ä»¶](https://web.dev/add-manifest/)ã€‚

ä¿®æ”¹ `docusaurus.config.js` æ·»åŠ æœ€å°åŒ– PWA é…ç½®ï¼Œä¾‹å¦‚ï¼š

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        debug: true,
        offlineModeActivationStrategies: [
          'appInstalled',
          'standalone',
          'queryString',
        ],
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json', // your PWA manifest
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
        ],
      },
    ],
  ],
};
```

## æ¸è¿›å¼ Web åº”ç”¨ {#progressive-web-app}

ä»…å®‰è£… Service Worker ä¸è¶³ä»¥ä½¿æ‚¨çš„åº”ç”¨æˆä¸º PWAã€‚æ‚¨è‡³å°‘éœ€è¦åŒ…å« [Web åº”ç”¨æ¸…å•](https://developer.mozilla.org/en-US/docs/Web/Manifest) å¹¶åœ¨ `<head>` ä¸­æ·»åŠ æ­£ç¡®çš„æ ‡ç­¾ï¼ˆå‚è§ [é€‰é¡¹ > pwaHead](#pwahead)ï¼‰ã€‚

éƒ¨ç½²åï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ [Lighthouse](https://developers.google.com/web/tools/lighthouse) å¯¹ç«™ç‚¹è¿›è¡Œå®¡è®¡ã€‚

æœ‰å…³æ„å»º PWA ç«™ç‚¹çš„å®Œæ•´è¦æ±‚æ¸…å•ï¼Œè¯·å‚é˜… [PWA æ£€æŸ¥è¡¨](https://developers.google.com/web/progressive-web-apps/checklist)

## åº”ç”¨å®‰è£…æ”¯æŒ {#app-installation-support}

å¦‚æœæµè§ˆå™¨æ”¯æŒï¼Œæ‚¨å¯ä»¥å°† Docusaurus ç«™ç‚¹ä½œä¸ºåº”ç”¨å®‰è£…ã€‚

![åº”ç”¨å®‰è£…è¿‡ç¨‹çš„å±å¹•å½•åˆ¶ã€‚æµè§ˆå™¨åœ°å€æ ä¸­å‡ºç°ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åä¼šæ˜¾ç¤ºå¯¹è¯æ¡†è¯¢é—®"æ˜¯å¦å®‰è£…æ­¤åº”ç”¨ï¼Ÿ"ã€‚ç‚¹å‡»"å®‰è£…"æŒ‰é’®åï¼Œæ“ä½œç³»ç»Ÿå°†æ‰“å¼€ä¸€ä¸ªæ–°åº”ç”¨ï¼Œæ˜¾ç¤º Docusaurus é¦–é¡µã€‚](/img/pwa_install.gif)

:::note

åº”ç”¨å®‰è£…éœ€è¦ HTTPS åè®®å’Œæœ‰æ•ˆçš„æ¸…å•æ–‡ä»¶ã€‚

:::

## ç¦»çº¿æ¨¡å¼ï¼ˆé¢„ç¼“å­˜ï¼‰ {#offline-mode-precaching}

æˆ‘ä»¬é€šè¿‡ Service Worker é¢„ç¼“å­˜æŠ€æœ¯ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿç¦»çº¿æµè§ˆ Docusaurus ç«™ç‚¹ã€‚

[workbox-precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching) é¡µé¢è§£é‡Šäº†å…¶åŸç†ï¼š

> Service Worker çš„ä¸€ä¸ªç‰¹æ€§æ˜¯åœ¨å®‰è£…æ—¶èƒ½å¤Ÿå°†ä¸€ç»„æ–‡ä»¶ä¿å­˜åˆ°ç¼“å­˜ä¸­ã€‚è¿™é€šå¸¸è¢«ç§°ä¸º"é¢„ç¼“å­˜"ï¼Œå› ä¸ºæ‚¨æ˜¯åœ¨ Service Worker è¢«ä½¿ç”¨ä¹‹å‰ç¼“å­˜å†…å®¹ã€‚
>
> è¿™æ ·åšçš„ä¸»è¦åŸå› æ˜¯è®©å¼€å‘è€…èƒ½å¤Ÿæ§åˆ¶ç¼“å­˜ï¼Œè¿™æ„å‘³ç€ä»–ä»¬å¯ä»¥å†³å®šæ–‡ä»¶ä½•æ—¶è¢«ç¼“å­˜ä»¥åŠç¼“å­˜å¤šé•¿æ—¶é—´ï¼Œå¹¶ä¸”æ— éœ€è®¿é—®ç½‘ç»œå³å¯å°†æ–‡ä»¶æä¾›ç»™æµè§ˆå™¨ï¼Œä»è€Œåˆ›å»ºå¯ç¦»çº¿å·¥ä½œçš„ Web åº”ç”¨ã€‚
>
> Workbox é€šè¿‡ç®€åŒ– API å¹¶ç¡®ä¿èµ„æºé«˜æ•ˆä¸‹è½½ï¼Œå¤§å¤§å‡è½»äº†é¢„ç¼“å­˜çš„å®ç°éš¾åº¦ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ç«™ç‚¹ä½œä¸ºåº”ç”¨å®‰è£…æ—¶ä¼šå¯ç”¨ç¦»çº¿æ¨¡å¼ã€‚è¯¦æƒ…è¯·å‚é˜… `offlineModeActivationStrategies` é€‰é¡¹ã€‚

ç«™ç‚¹é¢„ç¼“å­˜åï¼ŒService Worker å°†ä¸ºåç»­è®¿é—®æä¾›ç¼“å­˜å“åº”ã€‚å½“éƒ¨ç½²æ–°æ„å»ºç‰ˆæœ¬å¹¶ç”Ÿæˆæ–°çš„ Service Worker æ—¶ï¼Œæ–°ç‰ˆæœ¬å°†å¼€å§‹å®‰è£…å¹¶æœ€ç»ˆè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚åœ¨æ­¤ç­‰å¾…çŠ¶æ€ä¸‹ï¼Œå°†æ˜¾ç¤ºé‡æ–°åŠ è½½å¼¹çª—ï¼Œæç¤ºç”¨æˆ·åˆ·æ–°é¡µé¢ä»¥è·å–æ–°å†…å®¹ã€‚åœ¨ç”¨æˆ·æ¸…é™¤åº”ç”¨ç¼“å­˜æˆ–ç‚¹å‡»å¼¹çª—ä¸Šçš„`é‡æ–°åŠ è½½`æŒ‰é’®ä¹‹å‰ï¼ŒService Worker å°†ç»§ç»­æä¾›æ—§å†…å®¹ã€‚

:::warning

ç¦»çº¿æ¨¡å¼/é¢„ç¼“å­˜éœ€è¦æå‰ä¸‹è½½ç«™ç‚¹çš„æ‰€æœ‰é™æ€èµ„æºï¼Œå¯èƒ½ä¼šæ¶ˆè€—ä¸å¿…è¦çš„å¸¦å®½ã€‚å¯¹äºæŸäº›ç±»å‹çš„ç«™ç‚¹ï¼Œæ¿€æ´»æ­¤åŠŸèƒ½å¯èƒ½å¹¶éæ˜æ™ºä¹‹ä¸¾ã€‚

:::

## é€‰é¡¹ {#options}

### `debug` {#debug}

- ç±»å‹: `boolean`
- é»˜è®¤å€¼: `false`

å¯ç”¨è°ƒè¯•æ¨¡å¼ï¼š

- Workbox æ—¥å¿—
- é¢å¤–çš„ Docusaurus æ—¥å¿—
- æœªä¼˜åŒ–çš„æœåŠ¡å·¥ä½œè€…æ–‡ä»¶è¾“å‡º
- æºä»£ç æ˜ å°„

### `offlineModeActivationStrategies` {#offlinemodeactivationstrategies}

- ç±»å‹: `('appInstalled' | 'mobile' | 'saveData'| 'queryString' | 'always')[]`
- é»˜è®¤å€¼: `['appInstalled', 'queryString', 'standalone']`

ç”¨äºæ¿€æ´»ç¦»çº¿æ¨¡å¼çš„ç­–ç•¥ï¼š

- `appInstalled`: å¯¹å·²å®‰è£…ç«™ç‚¹ä¸ºåº”ç”¨çš„ç”¨æˆ·æ¿€æ´»ï¼ˆå¹¶é100%å¯é ï¼‰
- `standalone`: å¯¹ä»¥ç‹¬ç«‹åº”ç”¨æ¨¡å¼è¿è¡Œçš„ç”¨æˆ·æ¿€æ´»ï¼ˆé€šå¸¸æ˜¯PWAå®‰è£…åçš„æƒ…å†µï¼‰
- `queryString`: å½“æŸ¥è¯¢å­—ç¬¦ä¸²åŒ…å«`offlineMode=true`æ—¶æ¿€æ´»ï¼ˆä¾¿äºPWAè°ƒè¯•ï¼‰
- `mobile`: å¯¹ç§»åŠ¨ç«¯ç”¨æˆ·æ¿€æ´»ï¼ˆ`width <= 996px`ï¼‰
- `saveData`: å¯¹`navigator.connection.saveData === true`çš„ç”¨æˆ·æ¿€æ´»
- `always`: å¯¹æ‰€æœ‰ç”¨æˆ·æ¿€æ´»

:::warning

è°¨æ…ä½¿ç”¨ï¼šéƒ¨åˆ†ç”¨æˆ·å¯èƒ½ä¸å–œæ¬¢è¢«å¼ºåˆ¶ä½¿ç”¨ç¦»çº¿æ¨¡å¼ã€‚

:::

:::danger

æ— æ³•å¯é æ£€æµ‹é¡µé¢æ˜¯å¦ä»¥PWAå½¢å¼æ¸²æŸ“ã€‚

`appinstalled`äº‹ä»¶å·²[ä»è§„èŒƒä¸­ç§»é™¤](https://github.com/w3c/manifest/pull/836)ï¼Œä¸”[`navigator.getInstalledRelatedApps()`](https://web.dev/get-installed-related-apps/) APIä»…åœ¨æ–°ç‰ˆChromeä¸­æ”¯æŒï¼Œå¹¶è¦æ±‚åœ¨manifestä¸­å£°æ˜`related_applications`ã€‚

[`standalone`ç­–ç•¥](https://petelepage.com/blog/2019/07/is-my-pwa-installed/)æ˜¯æ¿€æ´»ç¦»çº¿æ¨¡å¼çš„è‰¯å¥½å›é€€æ–¹æ¡ˆï¼ˆè‡³å°‘åœ¨è¿è¡Œå·²å®‰è£…åº”ç”¨æ—¶æœ‰æ•ˆï¼‰ã€‚

:::

### `injectManifestConfig` {#injectmanifestconfig}

ä¼ é€’ç»™`workbox.injectManifest()`çš„[Workboxé…ç½®é¡¹](https://developer.chrome.com/docs/workbox/reference/workbox-build/#type-InjectManifestOptions)ã€‚ç”¨äºæ§åˆ¶å“ªäº›èµ„æºå°†è¢«é¢„ç¼“å­˜å¹¶æ”¯æŒç¦»çº¿è®¿é—®ã€‚

- ç±»å‹: `InjectManifestOptions`
- é»˜è®¤å€¼: `{}`

```js title="docusaurus.config.js"
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        injectManifestConfig: {
          manifestTransforms: [
            //...
          ],
          modifyURLPrefix: {
            //...
          },
          // We already add regular static assets (HTML, images...) to be available offline
          // You can add more files according to your needs
          globPatterns: ['**/*.{pdf,docx,xlsx}'],
          // ...
        },
      },
    ],
  ],
};
```

### `pwaHead` {#pwahead}

- ç±»å‹: `({ tagName: string; [attributeName: string]: string })[]`
- é»˜è®¤å€¼: `[]`

åŒ…å«`tagName`å’Œé”®å€¼å¯¹å±æ€§çš„å¯¹è±¡æ•°ç»„ï¼Œç”¨äºæ³¨å…¥`<head>`æ ‡ç­¾ã€‚æŠ€æœ¯ä¸Šå¯é€šè¿‡æ­¤æ³¨å…¥ä»»ä½•å¤´éƒ¨æ ‡ç­¾ï¼Œä½†ç†æƒ³æƒ…å†µä¸‹ç”¨äºä½¿ç«™ç‚¹ç¬¦åˆPWAè§„èŒƒçš„æ ‡ç­¾ã€‚ä»¥ä¸‹æ˜¯ä½¿åº”ç”¨å®Œå…¨åˆè§„çš„æ¨èæ ‡ç­¾åˆ—è¡¨ï¼š

```js
export default {
  plugins: [
    [
      '@docusaurus/plugin-pwa',
      {
        pwaHead: [
          {
            tagName: 'link',
            rel: 'icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'manifest',
            href: '/manifest.json',
          },
          {
            tagName: 'meta',
            name: 'theme-color',
            content: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-capable',
            content: 'yes',
          },
          {
            tagName: 'meta',
            name: 'apple-mobile-web-app-status-bar-style',
            content: '#000',
          },
          {
            tagName: 'link',
            rel: 'apple-touch-icon',
            href: '/img/docusaurus.png',
          },
          {
            tagName: 'link',
            rel: 'mask-icon',
            href: '/img/docusaurus.svg',
            color: 'rgb(37, 194, 160)',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileImage',
            content: '/img/docusaurus.png',
          },
          {
            tagName: 'meta',
            name: 'msapplication-TileColor',
            content: '#000',
          },
        ],
      },
    ],
  ],
};
```

### `swCustom` {#swcustom}

- ç±»å‹: `string | undefined`
- é»˜è®¤å€¼: `undefined`

ç”¨äºæ·»åŠ è‡ªå®šä¹‰Workboxè§„åˆ™ã€‚å¯åœ¨æ­¤å®ç°æœåŠ¡å·¥ä½œè€…æ”¯æŒçš„æ‰€æœ‰åŠŸèƒ½ï¼Œå¹¶å……åˆ†åˆ©ç”¨workboxåº“çš„èƒ½åŠ›ã€‚ä»£ç ä¼šè¢«è½¬è¯‘ï¼Œå› æ­¤å¯ä½¿ç”¨ç°ä»£ES6+è¯­æ³•ã€‚

ä¾‹å¦‚ç¼“å­˜å¤–éƒ¨è·¯ç”±æ–‡ä»¶ï¼š

```js
import {registerRoute} from 'workbox-routing';
import {StaleWhileRevalidate} from 'workbox-strategies';

// default fn export receiving some useful params
export default function swCustom(params) {
  const {
    debug, // :boolean
    offlineMode, // :boolean
  } = params;

  // Cache responses from external resources
  registerRoute((context) => {
    return [
      /graph\.facebook\.com\/.*\/picture/,
      /netlify\.com\/img/,
      /avatars1\.githubusercontent/,
    ].some((regex) => context.url.href.match(regex));
  }, new StaleWhileRevalidate());
}
```

æ¨¡å—éœ€å¯¼å‡º`default`å‡½æ•°ï¼Œå¹¶æ¥æ”¶è‹¥å¹²å‚æ•°ã€‚

### `swRegister` {#swregister}

- ç±»å‹: `string | false`
- é»˜è®¤å€¼: `'docusaurus-plugin-pwa/src/registerSW.js'`

åœ¨Docusaurusåº”ç”¨å‰æ·»åŠ å…¥å£ï¼Œç¡®ä¿æ³¨å†Œæµç¨‹åœ¨åº”ç”¨è¿è¡Œå‰å®Œæˆã€‚é»˜è®¤çš„`registerSW.js`æ–‡ä»¶å·²æ»¡è¶³åŸºæœ¬æ³¨å†Œéœ€æ±‚ã€‚

ä¼ å…¥`false`å°†å®Œå…¨ç¦ç”¨æ³¨å†ŒåŠŸèƒ½ã€‚

## Manifestç¤ºä¾‹ {#manifest-example}

Docusaurus ç«™ç‚¹æ¸…å•å¯ä½œä¸ºå‚è€ƒï¼š

import CodeBlock from '@theme/CodeBlock';

<CodeBlock className="language-json">
  {JSON.stringify(require('@site/static/manifest.json'),null,2)}
</CodeBlock>

## è‡ªå®šä¹‰é‡æ–°åŠ è½½å¼¹çª— {#customizing-reload-popup}

å½“æœ‰æ–°æœåŠ¡å·¥ä½œè€…ç­‰å¾…å®‰è£…æ—¶ï¼Œä¼šæ¸²æŸ“ `@theme/PwaReloadPopup` ç»„ä»¶ï¼Œå¹¶å‘ç”¨æˆ·å»ºè®®é‡æ–°åŠ è½½ã€‚æ‚¨å¯ä»¥[ç½®æ¢](../../swizzling.mdx)è¯¥ç»„ä»¶å¹¶å®ç°è‡ªå·±çš„ç”¨æˆ·ç•Œé¢ã€‚è¯¥ç»„ä»¶ä¼šæ¥æ”¶ä¸€ä¸ª `onReload` å›è°ƒä½œä¸ºå±æ€§ï¼Œåº”åœ¨ç‚¹å‡»"é‡æ–°åŠ è½½"æŒ‰é’®æ—¶è°ƒç”¨ã€‚è¿™å°†é€šçŸ¥æœåŠ¡å·¥ä½œè€…å®‰è£…ç­‰å¾…ä¸­çš„æœåŠ¡å·¥ä½œè€…å¹¶é‡æ–°åŠ è½½é¡µé¢ã€‚

é»˜è®¤ä¸»é¢˜åŒ…å«é‡æ–°åŠ è½½å¼¹çª—çš„å®ç°ï¼Œå¹¶ä½¿ç”¨ [Infima è­¦å‘Šæ¡†](https://infima.dev/docs/components/alert)ã€‚

![é‡æ–°åŠ è½½è¿‡ç¨‹çš„å±å¹•å½•åˆ¶ã€‚çª—å£å³ä¸‹è§’æ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šæ¡†ï¼Œæç¤º"æœ‰æ–°å†…å®¹å¯ç”¨"ã€‚ç‚¹å‡»"åˆ·æ–°"æŒ‰é’®åï¼Œé¡µé¢ä¸»æ ‡é¢˜ä»"ç®€ä»‹"å˜ä¸º"PWA :))"ã€‚](/img/pwa_reload.gif)

æ‚¨çš„ç»„ä»¶å¯ä»¥æ¸²æŸ“ `null`ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšï¼šç”¨æˆ·å°†æ— æ³•è·å–æœ€æ–°å†…å®¹ã€‚