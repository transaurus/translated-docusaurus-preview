---
slug: /migration/v2/versioned-sites
---

# 多版本站点

请先阅读 https://docusaurus.io/blog/2018/09/11/Towards-Docusaurus-2#versioning 了解v1版本控制方案存在的问题。

:::note

版本化文档通常可通过[迁移CLI](./migration-automated.mdx)正确迁移

:::

## 迁移 `versioned_docs` 的front matter {#migrate-your-versioned_docs-front-matter}

与v1不同，每个版本化文档的Markdown头部不再使用`version-${version}-${original_id}`作为实际ID字段的值。下方示例可更直观说明差异。

例如，假设你有一个`docs/hello.md`文件。

```md
---
id: hello
title: Hello, World !
---

Hi, Endilie here :)
```

当你创建新版本1.0.0时，在Docusaurus v1中，`website/versioned_docs/version-1.0.0/hello.md`内容如下：

```md
---
id: version-1.0.0-hello
title: Hello, World !
original_id: hello
---

Hi, Endilie here :)
```

相比之下，Docusaurus 2的`website/versioned_docs/version-1.0.0/hello.md`会保持与原文件完全一致：

```md
---
id: hello
title: Hello, World !
---

Hi, Endilie here :)
```

由于我们采用快照机制并允许用户在版本内自由移动（和编辑）文档，`id` front matter不再被修改且保持原值。内部实际ID会被处理为`version-${version}/${id}`。

每个versioned_docs文件需要做的主要变更如下：

```diff {2-3,5}
---
- id: version-1.0.0-hello
+ id: hello
title: Hello, World !
- original_id: hello
---
Hi, Endilie here :)
```

## 迁移 `versioned_sidebars` {#migrate-your-versioned_sidebars}

- 引用`versioned_docs`时使用`version-${version}/${id}`格式（v2），而非v1的`version-${version}-${original_id}`

因为在v1中，用户可能新建了front matter ID为`"version-${version}-${id}"`的文件，这会与`versioned_docs`的ID产生冲突。

例如，Docusaurus 1无法区分`docs/xxx.md`

```md
---
id: version-1.0.0-hello
---

Another content
```

和`website/versioned_docs/version-1.0.0/hello.md`

```md
---
id: version-1.0.0-hello
title: Hello, World !
original_id: hello
---

Hi, Endilie here :)
```

由于v1和v2都不允许在front matter中使用`/`字符，冲突概率已大幅降低。

因此v1用户需要迁移他们的versioned_sidebars文件

示例`versioned_sidebars/version-1.0.0-sidebars.json`：

```diff {2-3,5-6,9-10}  title="versioned_sidebars/version-1.0.0-sidebars.json"
{
+ "version-1.0.0/docs": {
- "version-1.0.0-docs": {
    "Test": [
+    "version-1.0.0/foo/bar",
-    "version-1.0.0-foo/bar",
    ],
    "Guides": [
+    "version-1.0.0/hello",
-    "version-1.0.0-hello"
    ]
  }
}
```

## 填充 `versioned_sidebars` 和 `versioned_docs` {#populate-your-versioned_sidebars-and-versioned_docs}

v2采用文档版本快照机制。**每个版本的文档不依赖其他版本**。可能出现`version-1.0.0`中有`foo.md`而`version-1.2.0`中没有的情况。这在旧版不可能实现，因为v1有回退功能(https://v1.docusaurus.io/docs/en/versioning#fallback-functionality)。

例如，v1中的`versions.json`如下时：

```json title="versions.json"
["1.1.0", "1.0.0"]
```

Docusaurus v1仅在文档内容变更时创建版本化文档。如果从v1.0.0到v1.1.0只有`hello.md`被修改，文档结构可能如下：

```bash
website
├── versioned_docs
│   ├── version-1.1.0
│   │   └── hello.md
│   └── version-1.0.0
│       ├── foo
│       │   └── bar.md
│       └── hello.md
├── versioned_sidebars
│   └── version-1.0.0-sidebars.json
```

在v2中，你需要手动补全缺失的`versioned_docs`和`versioned_sidebars`（同时确保front matter和ID引用正确）。

```bash {3-5,12}
website
├── versioned_docs
│   ├── version-1.1.0
│   │   ├── foo
│   │   │   └── bar.md
│   │   └── hello.md
│   └── version-1.0.0
│       ├── foo
│       │   └── bar.md
│       └── hello.md
├── versioned_sidebars
│   ├── version-1.1.0-sidebars.json
│   └── version-1.0.0-sidebars.json
```

## 将 MDX 中的样式属性转换为样式对象 {#convert-style-attributes-to-style-objects-in-mdx}

Docusaurus 2 在文档文件中使用 JSX。如果您在 Docusaurus 1 的文档中有任何样式属性，请将它们转换为样式对象，如下所示：

```diff
---
id: demo
title: Demo
---

## Section

hello world

- pre style="background: black">zzz</pre>
+ pre style={{background: 'black'}}>zzz</pre>
```