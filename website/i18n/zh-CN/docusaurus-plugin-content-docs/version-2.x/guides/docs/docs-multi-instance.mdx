---
id: multi-instance
description: Use multiple docs plugin instances on a single Docusaurus site.
slug: /docs-multi-instance
---

# 多实例文档

`@docusaurus/plugin-content-docs`插件支持[多实例](../../using-plugins.mdx#multi-instance-plugins-and-plugin-ids)配置。

:::note

此功能仅对[版本化文档](./versioning.mdx)有用。建议在阅读本页前先熟悉文档版本化功能。若仅需[多侧边栏](./sidebar/multiple-sidebars.mdx)，在单个插件内即可实现。

:::

## 使用场景 {#use-cases}

有时您可能希望在一个Docusaurus站点中托管两组（或更多）独立的文档。

这些文档可能还具有不同的版本发布周期。

### 移动端SDK文档 {#mobile-sdks-documentation}

如果您开发跨平台移动端SDK，可能有两套文档：

- Android SDK文档（`v1.0`、`v1.1`）
- iOS SDK文档（`v1.0`、`v2.0`）

这种情况下，可为每个移动端SDK文档使用独立的插件实例。

:::warning

若每个文档实例体量庞大，建议创建两个独立的Docusaurus站点。

当有人编辑iOS文档时，重建所有内容（包括未变更的整个Android文档）是否真的必要？

:::

### 版本化与非版本化文档 {#versioned-and-unversioned-doc}

有时您希望部分文档进行版本控制，而其他"全局性"文档则无需版本化。

Docusaurus官网就采用这种模式：

- [/docs/\*](/docs) 部分为版本化文档
- [/community/\*](/community/support) 部分为非版本化文档

## 配置方案 {#setup}

假设您有两类文档：

- 产品文档：关于产品的版本化文档
- 社区文档：关于产品社区的非版本化文档

此时应在站点配置中两次使用该插件。

:::warning

`@docusaurus/preset-classic`已默认包含一个文档插件实例！

:::

使用预设时：

```js title="docusaurus.config.js"
module.exports = {
  presets: [
    [
      '@docusaurus/preset-classic',
      {
        docs: {
          // highlight-start
          // id: 'product', // omitted => default instance
          // highlight-end
          path: 'product',
          routeBasePath: 'product',
          sidebarPath: require.resolve('./sidebarsProduct.js'),
          // ... other options
        },
      },
    ],
  ],
  plugins: [
    [
      '@docusaurus/plugin-content-docs',
      {
        // highlight-start
        id: 'community',
        // highlight-end
        path: 'community',
        routeBasePath: 'community',
        sidebarPath: require.resolve('./sidebarsCommunity.js'),
        // ... other options
      },
    ],
  ],
};
```

不使用预设时：

```js title="docusaurus.config.js"
module.exports = {
  plugins: [
    [
      '@docusaurus/plugin-content-docs',
      {
        // highlight-start
        // id: 'product', // omitted => default instance
        // highlight-end
        path: 'product',
        routeBasePath: 'product',
        sidebarPath: require.resolve('./sidebarsProduct.js'),
        // ... other options
      },
    ],
    [
      '@docusaurus/plugin-content-docs',
      {
        // highlight-start
        id: 'community',
        // highlight-end
        path: 'community',
        routeBasePath: 'community',
        sidebarPath: require.resolve('./sidebarsCommunity.js'),
        // ... other options
      },
    ],
  ],
};
```

请务必为每个插件实例分配唯一的`id`属性。

:::note

我们将`product`实例视为核心实例，通过不分配ID使其成为"默认"实例。

:::

## 版本化路径 {#versioned-paths}

每个插件实例会将版本化文档存储在不同目录。

默认插件实例使用以下路径：

- `website/versions.json`
- `website/versioned_docs`
- `website/versioned_sidebars`

其他插件实例（带`id`属性）使用以下路径：

- `website/[pluginId]_versions.json`
- `website/[pluginId]_versioned_docs`
- `website/[pluginId]_versioned_sidebars`

:::tip

可为某个文档插件实例省略`id`属性（默认为`default`)。

该实例路径会更简洁，且兼容单实例配置。

:::

## 标记新版本 {#tagging-new-versions}

每个插件实例都有独立的CLI命令来标记新版本。运行以下命令可查看：

```bash npm2yarn
npm run docusaurus -- --help
```

要为产品/默认文档插件实例创建版本：

```bash npm2yarn
npm run docusaurus docs:version 1.0.0
```

要为非默认/社区文档插件实例创建版本：

```bash npm2yarn
npm run docusaurus docs:version:community 1.0.0
```

## 文档导航栏项目 {#docs-navbar-items}

每个与文档相关的[主题导航栏项目](../../api/themes/theme-configuration.mdx#navbar)都可选配`docsPluginId`属性。

例如，若需要为每个移动端SDK（iOS和Android）分别设置版本下拉菜单，可配置如下：

```js title="docusaurus.config.js"
module.exports = {
  themeConfig: {
    navbar: {
      items: [
        {
          type: 'docsVersionDropdown',
          // highlight-start
          docsPluginId: 'ios',
          // highlight-end
        },
        {
          type: 'docsVersionDropdown',
          // highlight-start
          docsPluginId: 'android',
          // highlight-end
        },
      ],
    },
  },
};
```