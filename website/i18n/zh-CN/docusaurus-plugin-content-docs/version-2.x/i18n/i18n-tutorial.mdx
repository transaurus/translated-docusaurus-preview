---
id: tutorial
description: This tutorial will walk you through the basics of the Docusaurus i18n system.
slug: /i18n/tutorial
---

# i18n - 教程

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

本教程将引导您了解 **Docusaurus 国际化系统** 的基础知识。

我们将为一个 **新初始化的英文 Docusaurus 网站** 添加 **法语** 翻译。

使用 `npx create-docusaurus@latest website classic` 初始化一个新站点（类似 [这个示例](https://github.com/facebook/docusaurus/tree/main/examples/classic)）。

## 配置您的站点 {#configure-your-site}

修改 `docusaurus.config.js` 以添加对法语语言的国际化支持。

### 站点配置 {#site-configuration}

使用 [站点国际化配置](./../api/docusaurus.config.js.mdx#i18n) 来声明国际化语言环境：

```js title="docusaurus.config.js"
module.exports = {
  i18n: {
    defaultLocale: 'en',
    locales: ['en', 'fr', 'fa'],
    localeConfigs: {
      en: {
        htmlLang: 'en-GB',
      },
      // You can omit a locale (e.g. fr) if you don't need to override the defaults
      fa: {
        direction: 'rtl',
      },
    },
  },
};
```

语言环境名称用于翻译文件的存储位置，以及翻译后语言环境的基础 URL。在构建所有语言环境时，只有默认语言环境的名称会从基础 URL 中省略。

Docusaurus 使用语言环境名称提供 **合理的默认值**：`<html lang="...">` 属性、语言环境标签、日历格式等。您可以通过 `localeConfigs` 自定义这些默认值。

### 主题配置 {#theme-configuration}

添加一个类型为 `localeDropdown` 的 **导航栏项**，以便用户可以选择他们想要的语言环境：

```js title="docusaurus.config.js"
module.exports = {
  themeConfig: {
    navbar: {
      items: [
        // highlight-start
        {
          type: 'localeDropdown',
          position: 'left',
        },
        // highlight-end
      ],
    },
  },
};
```

### 启动您的站点 {#start-your-site}

以开发模式启动您的本地化站点，使用您选择的语言环境：

```bash npm2yarn
npm run start -- --locale fr
```

您的站点可以通过 [`http://localhost:3000/fr/`](http://localhost:3000/fr/) 访问。

由于尚未提供任何翻译，站点大部分内容仍为未翻译状态。

:::tip

Docusaurus 为通用主题标签提供了 **默认翻译**，例如分页的“Next”和“Previous”。

请帮助我们完善这些 **[默认翻译](https://github.com/facebook/docusaurus/tree/main/packages/docusaurus-theme-translations/locales)**。

:::

:::warning

每个语言环境都是一个 **独立的单页应用程序**：无法同时启动所有语言环境的 Docusaurus 站点。

:::

## 翻译您的站点 {#translate-your-site}

所有法语语言环境的翻译数据都存储在 `website/i18n/fr` 中。每个插件在相应文件夹下提供自己的翻译内容，而 `code.json` 文件定义了 React 代码中使用的所有文本标签。

:::note

在复制文件后，使用 `npm run start -- --locale fr` 重新启动您的站点。编辑现有文件时，热重载效果会更好。

:::

### 翻译您的 React 代码 {#translate-your-react-code}

对于您自己编写的任何 React 代码（React 页面、React 组件等），您将使用 [**翻译 API**](../docusaurus-core.mdx#translate)。

定位 React 代码中所有对用户可见的文本标签，并使用翻译 API 标记它们。有两种类型的 API：

- `<Translate>` 组件将字符串包装为 JSX 元素；
- `translate()` 回调函数接收消息并返回字符串。

根据语义上下文选择更适合的 API。例如，`<Translate>` 可以用作 React 子元素，而对于需要字符串的属性，可以使用回调函数。

:::warning

JSX 元素是一个_对象_，而非字符串。在需要字符串的上下文中使用它（例如 [`<option>`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/option) 的子元素）会[强制将其转换为字符串](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/toString)，返回 `"[object Object]"`。虽然我们鼓励您将 `<Translate>` 作为 JSX 子元素使用，但请仅在确实有效的情况下使用元素形式。

:::

<Tabs>
<TabItem value="Before">

```jsx title="src/pages/index.js"
import React from 'react';
import Layout from '@theme/Layout';
import Link from '@docusaurus/Link';

export default function Home() {
  return (
    <Layout>
      {/* highlight-next-line */}
      <h1>Welcome to my website</h1>
      <main>
        {/* highlight-start */}
        You can also visit my
        <Link to="https://docusaurus.io/blog">blog</Link>
        {/* highlight-end */}
        <img
          src="/img/home.png"
          // highlight-next-line
          alt="Home icon"
        />
      </main>
    </Layout>
  );
}
```

</TabItem>
<TabItem value="After">

```jsx title="src/pages/index.js"
import React from 'react';
import Layout from '@theme/Layout';
import Link from '@docusaurus/Link';

// highlight-next-line
import Translate, {translate} from '@docusaurus/Translate';

export default function Home() {
  return (
    <Layout>
      <h1>
        {/* highlight-next-line */}
        <Translate>Welcome to my website</Translate>
      </h1>
      <main>
        {/* highlight-start */}
        <Translate
          id="homepage.visitMyBlog"
          description="The homepage message to ask the user to visit my blog"
          values={{
            blogLink: (
              <Link to="https://docusaurus.io/blog">
                <Translate
                  id="homepage.visitMyBlog.linkLabel"
                  description="The label for the link to my blog">
                  blog
                </Translate>
              </Link>
            ),
          }}>
          {'You can also visit my {blogLink}'}
        </Translate>
        {/* highlight-end */}

        <img
          src="/img/home.png"
          alt={
            // highlight-start
            translate({
              message: 'Home icon',
              description: 'The homepage icon alt message',
            })
            // highlight-end
          }
        />
      </main>
    </Layout>
  );
}
```

</TabItem>
</Tabs>

:::info

Docusaurus 特意提供了一个**非常轻量级的翻译运行时**，仅支持基本的[占位符插值](../docusaurus-core.mdx#interpolate)，使用了 [ICU 消息格式](https://formatjs.io/docs/core-concepts/icu-syntax/) 的一个子集。

大多数文档网站通常是**静态的**，不需要高级的国际化功能（**复数**、**性别**等）。对于更高级的用例，请使用像 [react-intl](https://www.npmjs.com/package/react-intl) 这样的库。

:::

`docusaurus write-translations` 命令会静态分析您网站中使用的所有 React 代码文件，提取对这些 API 的调用，并将它们聚合到 `code.json` 文件中。翻译文件将存储为从 ID 到翻译消息对象（包括翻译后的标签和标签的描述）的映射。在调用翻译 API（`<Translate>` 或 `translate()`）时，您需要指定默认的未翻译消息或 ID，以便 Docusaurus 正确将每个翻译条目与 API 调用关联起来。

:::warning[文本标签必须是静态的]

`docusaurus write-translations` 命令仅对您的代码进行**静态分析**。它实际上并不运行您的网站。因此，无法提取动态消息，因为消息是一个_表达式_，而不是_字符串_：

```jsx
const items = [
  {id: 1, title: 'Hello'},
  {id: 2, title: 'World'},
];

function ItemsList() {
  return (
    <ul>
      {/* 不要这样做：无法与 write-translations 命令一起使用 */}
      {items.map((item) => (
        <li key={item.id}>
          <Translate>{item.title}</Translate>
        </li>
      ))}
    <ul>
  );
}
```

这在运行时仍然表现正确。然而，未来我们可能会提供一种“无运行时”机制，允许通过 Babel 转换直接将翻译内联到 React 代码中，而不是在运行时调用 API。因此，为了面向未来，您应该始终优先选择可静态分析的消息。例如，我们可以将上面的代码重构为：

```jsx
const items = [
  {id: 1, title: <Translate>Hello</Translate>},
  {id: 2, title: <Translate>World</Translate>},
];

function ItemsList() {
  return (
    <ul>
      {/* 标题在渲染时已经翻译好了！ */}
      {items.map((item) => (
        <li key={item.id}>{item.title}</li>
      ))}
    <ul>
  );
}
```

您可以将对翻译 API 的调用视为纯粹的_标记_，告诉 Docusaurus“这里有一个文本标签需要替换为翻译后的消息”。

:::

#### 复数形式 {#pluralization}

当您运行 `write-translations` 时，您会注意到一些标签是复数形式的：

```json title="i18n/en/code.json"
{
  // ...
  "theme.blog.post.plurals": "One post|{count} posts"
  // ...
}
```

每种语言都会有一系列[可能的复数类别](https://unicode-org.github.io/cldr-staging/charts/37/supplemental/language_plural_rules.html)。Docusaurus 会按照 `["zero", "one", "two", "few", "many", "other"]` 的顺序排列它们。例如，因为英语（`en`）有两种复数形式（“one”和“other”），翻译消息会用竖线（`|`）分隔两个标签。对于波兰语（`pl`）这样有三种复数形式（“one”、“few”和“many”）的语言，您需要按顺序提供三个标签，并用竖线连接。

您也可以为自己的代码消息添加复数形式：

```jsx
import {translate} from '@docusaurus/Translate';
import {usePluralForm} from '@docusaurus/theme-common';

function ItemsList({items}) {
  // `usePluralForm` will provide the plural selector for the current locale
  const {selectMessage} = usePluralForm();
  // Select the appropriate pluralized label based on `items.length`
  const message = selectMessage(
    items.length,
    translate(
      {message: 'One item|{count} items'},
      {count: items.length},
    ),
  );
  return (
    <>
      <h2>{message}</h2>
      <ul>{items.map((item) => <li key={item.id}>{item.title}</li>)}<ul>
    </>
  );
}
```

:::note

Docusaurus 使用 [`Intl.PluralRules`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/PluralRules) 来解析和选择复数形式。必须按照正确顺序提供适当数量的复数形式，才能确保 `selectMessage` 正常工作。

:::

### 翻译插件数据 {#translate-plugin-data}

JSON 翻译文件用于处理代码中所有需要国际化的内容：

- React 代码，包括已标记的翻译标签
- 主题配置中的导航栏和页脚标签
- `sidebars.js` 中的文档侧边栏分类标签
- 博客插件选项中的侧边栏标题
- ...

运行 [write-translations](../cli.mdx#docusaurus-write-translations-sitedir) 命令：

```bash npm2yarn
npm run write-translations -- --locale fr
```

该命令会提取并初始化需要翻译的 JSON 翻译文件。根目录下的 `code.json` 包含从源代码中提取的所有翻译 API 调用，这些调用可能由您编写或由主题提供，其中部分可能已默认翻译。

```json title="i18n/fr/code.json"
{
  // No ID for the <Translate> component: the default message is used as ID
  "Welcome to my website": {
    "message": "Welcome to my website"
  },
  "home.visitMyBlog": {
    "message": "You can also visit my {blog}",
    "description": "The homepage message to ask the user to visit my blog"
  },
  "homepage.visitMyBlog.linkLabel": {
    "message": "Blog",
    "description": "The label for the link to my blog"
  },
  "Home icon": {
    "message": "Home icon",
    "description": "The homepage icon alt message"
  }
}
```

插件和主题也会生成各自的 JSON 翻译文件，例如：

```json title="i18n/fr/docusaurus-theme-classic/navbar.json"
{
  "title": {
    "message": "My Site",
    "description": "The title in the navbar"
  },
  "item.label.Docs": {
    "message": "Docs",
    "description": "Navbar item with label Docs"
  },
  "item.label.Blog": {
    "message": "Blog",
    "description": "Navbar item with label Blog"
  },
  "item.label.GitHub": {
    "message": "GitHub",
    "description": "Navbar item with label GitHub"
  }
}
```

翻译 `i18n/fr` 目录下 JSON 文件中的 `message` 属性后，您的站点布局和主页现在应该已完成翻译。

### 翻译 Markdown 文件 {#translate-markdown-files}

官方 Docusaurus 内容插件广泛使用 Markdown/MDX 文件，并支持对其进行翻译。

#### 翻译文档 {#translate-the-docs}

将文档 Markdown 文件从 `docs/` 复制到 `i18n/fr/docusaurus-plugin-content-docs/current` 并进行翻译：

```bash
mkdir -p i18n/fr/docusaurus-plugin-content-docs/current
cp -r docs/** i18n/fr/docusaurus-plugin-content-docs/current
```

:::info

请注意 `docusaurus-plugin-content-docs` 插件始终按版本划分内容。`./docs` 文件夹中的数据将在 `current` 子文件夹和 `current.json` 文件中进行翻译。关于"current"的含义，请参阅[文档版本控制指南](../guides/docs/versioning.mdx#terminology)。

:::

#### 翻译博客 {#translate-the-blog}

将博客 Markdown 文件复制到 `i18n/fr/docusaurus-plugin-content-blog` 并进行翻译：

```bash
mkdir -p i18n/fr/docusaurus-plugin-content-blog
cp -r blog/** i18n/fr/docusaurus-plugin-content-blog
```

#### 翻译页面 {#translate-the-pages}

将页面 Markdown 文件复制到 `i18n/fr/docusaurus-plugin-content-pages` 并进行翻译：

```bash
mkdir -p i18n/fr/docusaurus-plugin-content-pages
cp -r src/pages/**.md i18n/fr/docusaurus-plugin-content-pages
cp -r src/pages/**.mdx i18n/fr/docusaurus-plugin-content-pages
```

:::warning

我们仅复制 `.md` 和 `.mdx` 文件，因为 React 页面已通过 JSON 翻译文件完成翻译。

:::

:::tip[使用显式标题 ID]

默认情况下，Markdown 标题 `### Hello World` 会生成 ID `hello-world`。其他文档可以通过 `[链接](#hello-world)` 引用它。但翻译后标题变为 `### Bonjour le Monde`，ID 变为 `bonjour-le-monde`。

生成的 ID 并不总是适合本地化站点，因为它要求您本地化所有锚点链接：

```diff
- [链接](#hello-world)
+ [链接](#bonjour-le-monde)
```

对于本地化站点，建议使用**[显式标题 ID](../guides/markdown-features/markdown-features-toc.mdx#heading-ids)**。

:::

## 部署站点 {#deploy-your-site}

您可以选择在**单一域名**下部署站点，或使用**多个（子）域名**。

### 单域名部署 {#single-domain-deployment}

运行以下命令：

```bash npm2yarn
npm run build
```

Docusaurus 将为每个语言环境构建**独立的单页应用**：

- `website/build`：默认用于英语语言
- `website/build/fr`：用于法语语言

现在您可以将 `build` 文件夹[部署](../deployment.mdx)到您选择的静态托管服务上。

:::note

Docusaurus v2 官网采用此策略：

- [`https://docusaurus.io`](https://docusaurus.io)
- [`https://docusaurus.io/fr`](https://docusaurus.io/fr)

:::

:::tip

静态托管服务通常会将 `/unknown/url` 重定向到 `/404.html`，这会导致始终显示**英文404页面**。

通过配置您的主机将 `/fr/*` 重定向到 `/fr/404.html` 来**本地化404页面**。

这并非总是可行，取决于您的主机：GitHub Pages 无法实现此功能，而 [Netlify](https://docs.netlify.com/routing/redirects/redirect-options/#custom-404-page-handling) 可以。

:::

### 多域名部署 {#multi-domain-deployment}

您也可以为单一语言构建站点：

```bash npm2yarn
npm run build -- --locale fr
```

Docusaurus 将不会添加 `/fr/` URL 前缀。

在您的[静态托管服务](../deployment.mdx)上：

- 为每个语言创建独立部署
- 使用 `--locale` 选项配置相应的构建命令
- 为每个部署配置您选择的（子）域名

:::warning

此策略**无法**在 GitHub Pages 上实现，因为它仅支持**单一部署**。

:::

### 混合部署 {#hybrid}

可以实现部分语言使用子路径，其他语言使用子域名。

也可以将每个语言部署为独立子域名，再通过CDN层将子域名整合到统一主域名下：

- 将站点部署为 `fr.docusaurus.io`
- 配置CDN使其通过 `docusaurus.io/fr` 提供服务

## 管理翻译 {#managing-translations}

Docusaurus 不关心您如何管理翻译：它只需要所有翻译文件（JSON、Markdown或其他数据文件）在构建时存在于文件系统中。但作为站点创建者，您需要考虑如何管理翻译，以便翻译贡献者能有效协作。

我们将分享两种常见的翻译协作策略：[**使用git**](./i18n-git.mdx) 和 [**使用Crowdin**](./i18n-crowdin.mdx)。