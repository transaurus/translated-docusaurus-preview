---
description: How to keep a reasonable bundle size while ensuring sufficient browser support.
---

# 浏览器支持

Docusaurus 允许站点通过 [browserslist 配置](https://github.com/browserslist/browserslist) 定义支持的浏览器列表。

## 目的 {#purpose}

网站需要在向后兼容性和打包体积之间取得平衡。由于旧版浏览器不支持现代 API 或语法，实现相同功能需要更多代码。

例如，您可能使用 [可选链语法](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Optional_chaining)：

```js
const value = obj?.prop?.val;
```

...但该语法仅在 2020 年后发布的浏览器版本中被识别。为了兼容早期浏览器版本，在生产环境构建站点时，我们的 JS 加载器会将代码转译为更冗长的语法：

```js
var _obj, _obj$prop;

const value =
  (_obj = obj) === null || _obj === void 0
    ? void 0
    : (_obj$prop = _obj.prop) === null || _obj$prop === void 0
    ? void 0
    : _obj$prop.val;
```

但这会以增加站点加载时间为代价影响所有用户——29 个字符的代码行变成了 168 个字符（增加了 6 倍！）。（实际情况下会稍好，因为使用的名称会更短。）作为权衡，JS 加载器仅转译到浏览器列表定义的所有版本都支持的语法程度。

默认的浏览器列表通过 `package.json` 文件中的根级 `browserslist` 字段提供。

:::warning

在旧版浏览器上，编译输出会使用不受支持（过于现代）的 JS 语法，导致 React 初始化失败，最终呈现为只有 HTML/CSS 而没有 JS 的静态网站。

:::

## 默认值 {#default-values}

使用经典模板初始化的网站会在 `package.json` 中包含以下配置：

```json title="package.json"
{
  "name": "docusaurus",
  // ...
  // highlight-start
  "browserslist": {
    "production": [">0.5%", "not dead", "not op_mini all"],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
  // highlight-end
  // ...
}
```

用自然语言解释，生产环境支持的浏览器是那些：

- 市场份额超过 0.5%；且
- 在过去 24 个月内有官方支持或更新（即非"已淘汰"浏览器）；且
- 不是 Opera Mini。

开发环境使用的浏览器是：

- Chrome、Firefox 或 Safari 的最新版本。

您可以通过 `browserslist` CLI "评估"任何配置以获取实际列表：

```bash
npx browserslist --env="production"
```

输出结果为生产环境支持的所有浏览器。以下是 2022 年 1 月的输出示例：

```text
and_chr 96
and_uc 12.12
chrome 96
chrome 95
chrome 94
edge 96
firefox 95
firefox 94
ie 11
ios_saf 15.2
ios_saf 15.0-15.1
ios_saf 14.5-14.8
ios_saf 14.0-14.4
ios_saf 12.2-12.5
opera 82
opera 81
safari 15.1
safari 14.1
safari 13.1
```

## 延伸阅读 {#read-more}

您可以访问 [browserslist 文档](https://github.com/browserslist/browserslist/blob/main/README.md) 获取更多规范说明，特别是可接受的 [查询值](https://github.com/browserslist/browserslist/blob/main/README.md#queries) 和 [最佳实践](https://github.com/browserslist/browserslist/blob/main/README.md#best-practices)。